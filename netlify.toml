# Netlify Configuration - CMS Admin Only
# Main website is deployed to GitHub Pages
# CMS admin is deployed to Netlify for authentication and content management

[build]
  command = "npm run build"
  publish = "dist/cms-admin"
  functions = "netlify/functions"
  # Only rebuild when CMS or content files change
  ignore = "git diff --quiet HEAD^ HEAD -- cms-admin/ content/ netlify.toml package.json"

# Single Page Application routing for CMS
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  force = false

# Security headers for CMS
[[headers]]
  for = "/*"
  [headers.values]
    X-Robots-Tag = "noindex, nofollow"  # Prevent search engine indexing
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Content-Security-Policy = "default-src 'self' https:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://unpkg.com https://identity.netlify.com; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; connect-src 'self' https:;"

# Cache control for CMS assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=3600"  # 1 hour cache for CMS assets

# Enable Netlify Identity for authentication
[[plugins]]
  package = "@netlify/plugin-sitemap"
  
  [plugins.inputs]
    exclude = ["**/*"]  # Don't generate sitemap for CMS
